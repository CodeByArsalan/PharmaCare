@model PharmaCare.Domain.Models.Finance.SupplierPayment
@{
    ViewData["Title"] = "Payment Details";
}

<div class="container-fluid p-0">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bx bx-receipt me-2"></i>Payment Details</h5>
                    <span class="badge @(Model.Status == "Paid" ? "bg-success" : "bg-danger") fs-6">@Model.Status</span>
                </div>
                <div class="card-body">
                    <!-- Payment Info -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="40%">Payment Number:</th>
                                    <td><strong>@Model.PaymentNumber</strong></td>
                                </tr>
                                <tr>
                                    <th>Payment Date:</th>
                                    <td>@Model.PaymentDate.ToString("dd-MMM-yyyy")</td>
                                </tr>
                                <tr>
                                    <th>Payment Method:</th>
                                    <td>@Model.PaymentMethod</td>
                                </tr>
                                @if (!string.IsNullOrEmpty(Model.ChequeNumber))
                                {
                                    <tr>
                                        <th>Cheque Number:</th>
                                        <td>@Model.ChequeNumber</td>
                                    </tr>
                                    <tr>
                                        <th>Cheque Date:</th>
                                        <td>@Model.ChequeDate?.ToString("dd-MMM-yyyy")</td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Model.BankReference))
                                {
                                    <tr>
                                        <th>Bank Reference:</th>
                                        <td>@Model.BankReference</td>
                                    </tr>
                                }
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="40%">Supplier:</th>
                                    <td>@Model.Party?.PartyName</td>
                                </tr>
                                <tr>
                                    <th>GRN Number:</th>
                                    <td>@Model.Grn?.GrnNumber</td>
                                </tr>
                                <tr>
                                    <th>Store:</th>
                                    <td>@Model.Store?.Name</td>
                                </tr>
                                <tr>
                                    <th>Payment Type:</th>
                                    <td>
                                        <span
                                            class="badge @(Model.PaymentType == "Full" ? "bg-success" : "bg-warning")">
                                            @Model.PaymentType Payment
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <hr />

                    <!-- Amount Details -->
                    <div class="row mb-4">
                        <div class="col-md-4 text-center">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <small class="text-muted">GRN Amount</small>
                                    <h4>Rs. @Model.GrnAmount.ToString("N2")</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <small>Amount Paid</small>
                                    <h4>Rs. @Model.AmountPaid.ToString("N2")</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="card @(Model.BalanceAfter > 0 ? "bg-warning" : "bg-secondary") text-white">
                                <div class="card-body">
                                    <small>Balance After</small>
                                    <h4>Rs. @Model.BalanceAfter.ToString("N2")</h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Notes))
                    {
                        <div class="card bg-light mb-4">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2 text-muted">Notes</h6>
                                <p class="card-text">@Model.Notes</p>
                            </div>
                        </div>
                    }

                    <!-- Journal Entry Link -->
                    @if (Model.JournalEntry_ID.HasValue)
                    {
                        <div class="alert alert-info">
                            <i class="fas fa-book me-2"></i>
                            <strong>Journal Entry:</strong> @Model.JournalEntry?.EntryNumber
                            <a href="@Url.Action("JournalEntryDetails", "JournalEntry", new { id = Utility.EncryptURL(Model.JournalEntry_ID.ToString2()) })"
                                class="btn btn-sm btn-outline-info ms-2">
                                View Entry
                            </a>
                        </div>
                    }

                    <!-- Audit Info -->
                    <div class="small text-muted">
                        <hr />
                        @* <p class="mb-1">Created: @Model.CreatedDate.ToString("dd-MMM-yyyy HH:mm") by User #@Model.CreatedBy</p> *@
                        <p class="mb-1">Created: @Model.CreatedDate.ToString("dd-MMM-yyyy HH:mm")</p>
                        @if (Model.UpdatedDate.HasValue)
                        {
                            <p class="mb-0">Last Updated: @Model.UpdatedDate?.ToString("dd-MMM-yyyy HH:mm")</p>
                        }
                    </div>
                </div>
                <div class="card-footer d-flex justify-content-end">
                    <a href="@Url.Action("SupplierPaymentIndex")" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-1"></i> Back to List
                    </a>
                    @* @if (Model.Status == "Paid")
                    {
                        <form asp-action="CancelSupplierPayment" asp-route-id="@Model.SupplierPaymentID" method="post"
                            onsubmit="return confirm('Are you sure you want to cancel this payment? This will reverse the journal entry.');">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-times me-1"></i> Cancel Payment
                            </button>
                        </form>
                    } *@
                </div>
            </div>
        </div>
    </div>
</div>
