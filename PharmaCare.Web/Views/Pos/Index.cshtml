@{
    ViewData["Title"] = "Point of Sale";
}

<div class="container-fluid flex-grow-1 container-p-y p-0">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold mb-0">
            <span class="text-muted fw-light">Sales /</span> Point of Sale
        </h4>
        <div>
            <span class="badge bg-label-warning me-2" id="heldSalesBadge" style="cursor: pointer;"
                onclick="window.location.href='/HeldSale/HeldSaleIndex'">
                <i class="bx bx-pause-circle me-1"></i>
                Held: <span id="heldSalesCount">0</span>
            </span>
            <span class="badge bg-label-primary me-2">
                <i class="bx bx-shopping-bag me-1"></i>
                Cart: <span id="cartCount">0</span>
            </span>
            <button class="btn btn-sm btn-label-secondary" onclick="clearCart()">
                <i class="bx bx-trash"></i> Clear Cart
            </button>
        </div>
    </div>

    <div class="row">
        <!-- Left Panel: Product Search -->
        <div class="col-lg-7 col-md-12 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Product Search</h5>
                </div>
                <div class="card-body">
                    <!-- Search Input -->
                    <div class="mb-3">
                        <div class="input-group input-group-merge">
                            <span class="input-group-text"><i class="bx bx-search"></i></span>
                            <input type="text" id="productSearch" class="form-control form-control-lg"
                                placeholder="Search by product name or barcode..." autocomplete="off">
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div id="searchResults" class="table-responsive">
                        <div class="text-center text-muted py-5">
                            <i class="bx bx-search-alt bx-lg"></i>
                            <p class="mt-2">Start typing to search for products</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Cart -->
        <div class="col-lg-5 col-md-12">
            <div class="card sticky-top" style="top: 80px;">
                <div class="card-header">
                    <h5 class="mb-0">Shopping Cart</h5>
                </div>
                <div class="card-body">
                    <!-- Cart Items -->
                    <div id="cartItems" style="max-height: 400px; overflow-y: auto;">
                        <div class="text-center text-muted py-5">
                            <i class="bx bx-cart bx-lg"></i>
                            <p class="mt-2">Your cart is empty</p>
                        </div>
                    </div>

                    <!-- Cart Summary -->
                    <div class="border-top pt-3 mt-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Subtotal:</span>
                            <span>Rs. <span id="cartSubtotal">0.00</span></span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Discount:</span>
                            <span class="text-danger">- Rs. <span id="cartDiscount">0.00</span></span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Total:</h5>
                            <h4 class="mb-0 text-primary">Rs. <span id="cartTotal">0.00</span></h4>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-warning flex-grow-1" id="holdBtn" onclick="openHoldModal()" disabled>
                                <i class="bx bx-pause-circle me-1"></i> Hold Sale
                            </button>
                            <button class="btn btn-primary flex-grow-1" id="checkoutBtn" onclick="openCheckoutModal()"
                                disabled>
                                <i class="bx bx-credit-card me-1"></i> Checkout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Checkout Modal -->
<div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Complete Sale</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="checkoutForm">
                    <!-- Customer Selection -->
                    <div class="mb-3">
                        <label class="form-label">Customer Type</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="customerType" id="typeWalkIn" checked
                                onchange="toggleCustomerType()">
                            <label class="btn btn-outline-primary" for="typeWalkIn">Walk-in</label>

                            <input type="radio" class="btn-check" name="customerType" id="typeExisting"
                                onchange="toggleCustomerType()">
                            <label class="btn btn-outline-primary" for="typeExisting">Registered Customer</label>
                        </div>
                    </div>

                    <div id="existingCustomerDiv" class="mb-3 d-none">
                        <label class="form-label">Select Customer</label>
                        <select class="form-select" id="customerSelect">
                            <option value="">Loading...</option>
                        </select>
                    </div>

                    <!-- Customer Information -->
                    <div class="row mb-3" id="customerInfoDiv">
                        <div class="col-md-6">
                            <label class="form-label">Customer Name <span id="nameOptionalLabel"
                                    class="text-muted">(Optional)</span></label>
                            <input type="text" class="form-control" id="customerName" placeholder="Enter name">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Phone <span id="phoneOptionalLabel"
                                    class="text-muted">(Optional)</span></label>
                            <input type="text" class="form-control" id="customerPhone" placeholder="Enter phone">
                        </div>
                    </div>

                    <!-- Payment Details -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Payment Method *</label>
                            <select class="form-select" id="paymentMethod">
                                <option value="Cash" selected>Cash</option>
                                <option value="Card">Card</option>
                                <option value="Mobile">Mobile Payment</option>
                                <option value="Mixed">Mixed</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Reference Number</label>
                            <input type="text" class="form-control" id="referenceNumber"
                                placeholder="Card/Transaction ref">
                        </div>
                    </div>

                    <!-- Discount Section -->
                    <div class="row mb-3 bg-light p-3 rounded">
                        <h6 class="mb-2"><i class="bx bx-discount me-1"></i> Invoice Discount</h6>
                        <div class="col-md-4">
                            <label class="form-label small">Discount %</label>
                            <input type="number" class="form-control" id="discountPercent" placeholder="0" min="0"
                                max="100" step="0.01" oninput="calculateDiscount()">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small">Discount Amount</label>
                            <input type="number" class="form-control" id="discountAmount" placeholder="0.00" min="0"
                                step="0.01" oninput="calculateDiscountFromAmount()">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small">Net Total</label>
                            <input type="text" class="form-control bg-white" id="netTotal" readonly>
                        </div>
                    </div>

                    <!-- Amount Tendered -->
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label class="form-label">Amount Tendered *</label>
                            <input type="number" class="form-control form-control-lg" id="amountTendered"
                                placeholder="0.00" step="0.01" oninput="calculateChange()">
                        </div>
                    </div>

                    <!-- Change Display -->
                    <div class="alert alert-info d-none" id="changeAlert">
                        <div class="d-flex justify-content-between">
                            <span><strong>Change to Return:</strong></span>
                            <span class="fw-bold">Rs. <span id="changeAmount">0.00</span></span>
                        </div>
                    </div>

                    <!-- Order Summary -->
                    <div class="border-top pt-3">
                        <h6 class="mb-2">Order Summary</h6>
                        <div class="d-flex justify-content-between mb-1">
                            <span>Items:</span>
                            <span id="checkoutItemCount">0</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <strong>Total Amount:</strong>
                            <strong class="text-primary">Rs. <span id="checkoutTotal">0.00</span></strong>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="completeSale()">
                    <i class="bx bx-check me-1"></i> Complete Sale
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Hold Sale Modal -->
<div class="modal fade" id="holdModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title"><i class="bx bx-pause-circle me-2"></i>Hold/Park Sale</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">This sale will be saved and can be resumed later.</p>
                <div class="mb-3">
                    <label class="form-label">Customer Name (Optional)</label>
                    <input type="text" class="form-control" id="holdCustomerName" placeholder="Enter customer name">
                </div>
                <div class="mb-3">
                    <label class="form-label">Customer Phone (Optional)</label>
                    <input type="text" class="form-control" id="holdCustomerPhone" placeholder="Enter phone number">
                </div>
                <div class="mb-3">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea class="form-control" id="holdNotes" rows="2" placeholder="Any notes about this sale..."></textarea>
                </div>
                <div class="alert alert-info mb-0">
                    <i class="bx bx-info-circle me-1"></i>
                    <span id="holdItemCount">0</span> items will be held
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="holdSale()">
                    <i class="bx bx-pause-circle me-1"></i> Hold Sale
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/pos.js" asp-append-version="true"></script>
}
