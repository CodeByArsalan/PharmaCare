@model PharmaCare.Application.DTOs.Accounting.TrialBalanceDto
@{
    ViewData["Title"] = "Trial Balance";
}

<div class="row page-titles mb-2 mt-2 d-print-none">
    <div class="col-md-5 align-self-center">
        <h3 class="text-primary fw-bold text-uppercase mb-0">Trial Balance</h3>
    </div>
    <div class="col-md-7 align-self-center text-end">
        <button onclick="window.print()" class="btn btn-info">
            <i class="bx bx-print me-1"></i> Print Report
        </button>
    </div>
</div>

<div class="container-fluid p-0">
    <!-- Filter Card -->
    <div class="card border-0 shadow-sm rounded-3 mb-4 d-print-none">
        <div class="card-body p-3">
            <form asp-action="TrialBalance" method="get" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label small fw-bold text-secondary">As of Date</label>
                    <input type="date" name="asOfDate" value="@Model.AsOfDate.ToString("yyyy-MM-dd")"
                        class="form-control rounded-3 shadow-sm" />
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bx bx-sync-alt me-1"></i> Regenerate
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Report Header (Print Only) -->
    <div class="d-none d-print-block text-center mb-5">
        <h1 class="fw-bold mb-1">PharmaCare</h1>
        <h3 class="text-uppercase mb-2">Trial Balance</h3>
        <p class="text-muted">As of @Model.AsOfDate.ToString("dd MMMM yyyy")</p>
        <hr />
    </div>

    <div class="card border-0 shadow-sm rounded-3 overflow-hidden">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-primary text-white border-bottom">
                        <tr>
                            <th class="ps-4 py-3" style="width: 60%;">Account Name</th>
                            <th class="text-end py-3" style="width: 20%;">Debit</th>
                            <th class="text-end pe-4 py-3" style="width: 20%;">Credit</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Lines != null && Model.Lines.Any())
                        {
                            @foreach (var item in Model.Lines.OrderBy(i => i.AccountName))
                            {
                                <tr>
                                    <td class="ps-4">@item.AccountName</td>
                                    <td class="text-end fw-bold text-primary">
                                        @(item.DebitBalance > 0 ? item.DebitBalance.ToString("N2") : "-")
                                    </td>
                                    <td class="text-end pe-4 fw-bold text-success">
                                        @(item.CreditBalance > 0 ? item.CreditBalance.ToString("N2") : "-")
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                    <tfoot class="bg-light border-top border-2">
                        <tr class="fw-bold h4">
                            <td class="text-end ps-4 py-4">Total</td>
                            <td class="text-end text-primary py-4">@Model.TotalDebits.ToString("N2")</td>
                            <td class="text-end pe-4 text-success py-4">@Model.TotalCredits.ToString("N2")</td>
                        </tr>
                        @if (!Model.IsBalanced)
                        {
                            <tr class="bg-danger text-white">
                                <td colspan="4" class="text-center py-2 h5">
                                    <i class="bx bx-exclamation-triangle me-2"></i> Warning: Trial Balance is NOT balanced!
                                </td>
                            </tr>
                        }
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
